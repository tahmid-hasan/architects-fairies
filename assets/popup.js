class Popup extends HTMLElement{constructor(){super()}connectedCallback(){this.modal=null,this.mask=document.querySelector(".popup-modal-mask"),theme.popup.enabled&&this.passesExpiration()&&(0<theme.popup.page_content.length||theme.popup.newsletter_enabled||theme.popup.show_image_enabled||theme.popup.social_icons_enabled)&&setTimeout(()=>{1!=this.maskIsActive()&&this.mask&&this.fillPopupDialog()},1e3*theme.popup.seconds_until)}storeExpiration(){const e=new Date;var t=864e5*theme.popup.days_until,t=e.setTime(e.getTime()+t);try{localStorage[theme.local_storage.popup]=JSON.stringify({expires:t})}catch(e){return!1}}resetExpiration(){localStorage.removeItem(theme.local_storage.popup),this.storeExpiration()}isExpired(){var e=JSON.parse(localStorage[theme.local_storage.popup]).expires,t=(new Date).getTime();return parseFloat(e-t)<=0&&(this.resetExpiration(),!0)}passesExpiration(){let e=!1;try{theme.popup.test_mode?e=!0:void 0===localStorage[theme.local_storage.popup]?(e=!0,this.storeExpiration()):e=this.isExpired()}catch{e=!0}return e}maskIsActive(){var e=document.querySelector(".popup-modal");return null!==e&&"none"!==e.style.display}showMask(){this.mask.style.display="block",document.body.classList.add("modal-on")}hideMask(){this.mask.style.display="none",document.body.classList.remove("modal-on")}getImage(){if(!1===theme.popup.show_image_enabled)return"";if(0<theme.popup.image_link.length)return theme.utils.parseHtml(`
        <div class='popup-image'>
          <a href='${theme.popup.image_link}'>${theme.popup.show_image_url}</a>
        </div>`);{const t=theme.utils.parseHtml('<div class="popup-image">');var e=theme.utils.parseHtml(theme.popup.show_image_url);return t.appendChild(e),t}}getNewsletter(){if(!1===theme.popup.newsletter_enabled)return"";const e=theme.utils.parseHtml("<div id='subscribe_module'></div>");return e.appendChild(this),e}getSocialIcons(){return!1===theme.popup.social_icons_enabled?"":document.querySelector(".footer--social-icons").cloneNode(!0)}getCustomClasses(){let e="";return!0===theme.popup.show_image_enabled?e+=" has-image":e+=" has-no-image",0<theme.popup.page_content.length?e+=" has-page-content":e+=" has-no-page-content",theme.popup.newsletter_enabled?e+=" has-newsletter":e+=" has-no-newsletter",theme.popup.social_icons_enabled?e+=" has-social-icons":e+=" has-no-social-icons",e}getWrapper(){return theme.utils.parseHtml(`<dialog class='popup popup-modal ${this.getCustomClasses()}'/>`)}fillPopupDialog(){if(this.dialog={body:null,image:this.getImage(),newsletter:this.getNewsletter(),social_icons:this.getSocialIcons(),wrapper:this.getWrapper()},0<theme.popup.page_content.length){const t=new XMLHttpRequest;t.onload=()=>{var e;200<=t.status&&t.status<300&&(e=JSON.parse(t.response).page.body_html,this.dialog.body=theme.utils.parseHtml(`<div class='page-contents'>${e}</div>`),this.render())},t.onerror=()=>console.log(t.statusText+": popup.json request failed!"),t.open("GET",`/pages/${theme.popup.page_content}.json`),t.send()}else this.render()}getInnerContent(){if(theme.popup.page_content.length<1&&!1===theme.popup.newsletter_enabled&&!1===theme.popup.social_icons_enabled)return!1;const e=theme.utils.parseHtml("<div class='inner'></div>");return this.dialog.body&&e.appendChild(this.dialog.body),this.dialog.newsletter&&e.appendChild(this.dialog.newsletter),this.dialog.social_icons&&e.appendChild(this.dialog.social_icons),e}render(){var e=this.getInnerContent();e&&(this.dialog.image&&this.dialog.wrapper.appendChild(this.dialog.image),this.dialog.wrapper.appendChild(e),document.body.appendChild(this.dialog.wrapper),this.openDialog())}checkContentOverflow(){setTimeout(()=>{let e=!0;"none"===document.querySelector(".popup-modal-mask").style.display&&(e=!1),this.modal&&e&&theme.utils.imagesLoaded(this.modal,()=>{document.querySelector("dialog[class*='popup']:last-of-type").offsetHeight>=window.innerHeight?document.body.classList.add("modal-unfix"):document.body.classList.remove("modal-unfix")})},0)}openDialog(){this.modal=document.querySelector("dialog[class*='popup']"),this.eventListeners(),this.modal&&(this.modal.classList.add("opened"),this.modal.classList.remove("closed")),this.checkContentOverflow(),this.showMask()}eventListeners(){const e=document.querySelector(".popup-modal-close");e&&e.on("click",()=>this.closeDialog()),this.mask.on("click",()=>this.closeDialog()),this.modal&&this.modal.on("animationend",e=>{"modal-close"===e.animationName?e.target.remove():(e.target.classList.add("completed"),e.target.classList.remove("opened"))}),window.on("resize",()=>this.checkContentOverflow()),document.addEventListener("keydown",e=>{this.modal.classList.contains("completed")&&"Escape"===e.code&&this.closeDialog()})}closeDialog(){this.modal.classList.add("closed"),this.modal.classList.remove("completed"),this.modal.classList.remove("opened"),this.hideMask()}}customElements.define("popup-root",Popup);